<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Experimenter's Hunger Tracker</title>
<style>
  body { font-family: Arial, sans-serif; background: #121212; color: #eee; padding: 20px; max-width: 600px; margin: auto; }
  h1, h2 { color: #ffcc66; }
  label { display: block; margin-top: 10px; }
  input, select, button { margin-top: 5px; padding: 5px; font-size: 1rem; }
  .effects, .benefits { background: #1e1e1e; padding: 10px; border-radius: 8px; margin-top: 10px; }
  .warning { color: #ff6666; font-weight: bold; }
</style>
</head>
<body>

<h1>The Experimenter's Hunger</h1>

<label>Barbarian Level:
  <input type="number" id="level" min="1" max="20">
</label>

<label>Rages Used This Long Rest:
  <input type="number" id="ragesUsed" min="0">
</label>

<label>Consecutive Failed Long Rests:
  <input type="number" id="failedRests" min="0">
</label>

<button id="longRestBtn">Finish Long Rest</button>

<h2>Rage Quota</h2>
<p id="quota"></p>

<h2>Current Withdrawal Effects</h2>
<div class="effects" id="effects"></div>

<h2>Augmented Fury Benefits</h2>
<div class="benefits" id="benefits"></div>

<script>
function saveData() {
  localStorage.setItem("level", document.getElementById("level").value);
  localStorage.setItem("ragesUsed", document.getElementById("ragesUsed").value);
  localStorage.setItem("failedRests", document.getElementById("failedRests").value);
}

function loadData() {
  document.getElementById("level").value = localStorage.getItem("level") || 1;
  document.getElementById("ragesUsed").value = localStorage.getItem("ragesUsed") || 0;
  document.getElementById("failedRests").value = localStorage.getItem("failedRests") || 0;
  updateDisplay();
}

function getQuota(level) {
  if (level <= 2) return 1;
  if (level <= 5) return 2;
  if (level <= 11) return 3;
  if (level <= 16) return 4;
  return 5;
}

function updateDisplay() {
  const level = parseInt(document.getElementById("level").value) || 1;
  const rages = parseInt(document.getElementById("ragesUsed").value) || 0;
  const failed = parseInt(document.getElementById("failedRests").value) || 0;
  const quota = getQuota(level);

  document.getElementById("quota").textContent = `Level ${level} → Rage at least ${quota} time(s) per long rest.`;

  // Withdrawal effects (cumulative)
  let effects = [];
  if (rages < quota) {
    if (level >= 1) effects.push("Unsettled Form: Disadvantage on initiative rolls.");
    if (level >= 6) effects.push("Primal Urge: DC 10 Wisdom save or frightened of nearest enemy at start of combat.");
    if (level >= 11) effects.push("Internal Volatility: Disadvantage on CON saves and -10 ft speed.");
    if (level >= 16) effects.push("Mental Corruption: Disadvantage on WIS and CHA saves.");
  } else {
    effects.push("None — Quota met!");
  }
  document.getElementById("effects").innerHTML = effects.map(e => `<p>${e}</p>`).join("");

  // Augmented Fury benefits (cumulative)
  let benefits = [];
  if (level >= 1) benefits.push("Bolstered Resilience: Resistance to one damage type (except B/P/S) until rage ends.");
  if (level >= 6) benefits.push("Overcharged Metabolism: Once per turn on hit, regain HP equal to proficiency bonus.");
  if (level >= 11) benefits.push("Adaptive Physiology: Once per rage, reaction to gain temp HP = barbarian level.");
  if (level >= 16) benefits.push("Transcendence of Flesh: Immune to poisoned/frightened, adv. on saves vs condition spells/effects.");
  document.getElementById("benefits").innerHTML = benefits.map(b => `<p>${b}</p>`).join("");

  saveData();
}

document.getElementById("level").addEventListener("input", updateDisplay);
document.getElementById("ragesUsed").addEventListener("input", updateDisplay);
document.getElementById("failedRests").addEventListener("input", updateDisplay);

document.getElementById("longRestBtn").addEventListener("click", () => {
  const level = parseInt(document.getElementById("level").value) || 1;
  const rages = parseInt(document.getElementById("ragesUsed").value) || 0;
  const quota = getQuota(level);
  let failed = parseInt(document.getElementById("failedRests").value) || 0;

  if (rages < quota) {
    failed++;
    alert(`Quota not met! Failed long rests in a row: ${failed}`);
  } else {
    failed = 0;
    alert("Quota met! No withdrawal penalties next rest.");
  }

  if (failed >= 3) {
    alert("⚠ Permanent Level of Exhaustion gained due to addiction progression!");
  }

  document.getElementById("failedRests").value = failed;
  document.getElementById("ragesUsed").value = 0;
  updateDisplay();
});

loadData();
</script>

</body>
</html>
